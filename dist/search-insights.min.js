!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AlgoliaAnalytics=t()}(this,function(){"use strict";var e,t,r,n,i=function(){var e=this;if(this.storeClick=function(t,r){var n=JSON.parse(localStorage.getItem("insights-store"))||{};n[t]={queryID:r,eventTimestamp:(new Date).getTime()},localStorage.setItem(e._storageKey,JSON.stringify(n))},this.getConversionObjectID=function(t){var r=e.getStorageData()[t];return r&&r.queryID?r.queryID:void 0},this.cleanOldStorage=function(e,t){var r=Object.keys(t);return r.length>0?r.reduce(function(r,n){var i=t[n];return Math.abs(e-i.eventTimestamp)/36e5<=6&&(r[n]=i),r},{}):{}},this.getStorageData=function(){return JSON.parse(localStorage.getItem("insights-store"))||{}},!function(e){try{var t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("localStorage"))throw new Error("LocalStorage is not available");this._storageKey="insights-store";var t=(new Date).getTime(),r=this.getStorageData(),n=this.cleanOldStorage(t,r);localStorage.setItem(this._storageKey,JSON.stringify(n))},o=function(e,t,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"},a=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},s=function(e){var t=function(e){for(var t=e+"=",r=decodeURIComponent(document.cookie).split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}("_ALGOLIA");if(t&&""!==t)return o("_ALGOLIA",t,10),t;var r=a();return o("_ALGOLIA",r,10),r};Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var o,a,s=[];for(o in i)e.call(i,o)&&s.push(o);if(t)for(a=0;a<n;a++)e.call(i,r[a])&&s.push(r[a]);return s})),"function"!=typeof Object.assign&&(Object.assign=function(e,t){var r=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var o=r[i];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n});return new function(e){if(this._hasCredentials=!1,!document.addEventListener||!window)throw new Error("Browser does not support eventlistener or there is no window object.");this.storageManager=new i,this.processQueue=function(){var e=this,t=window.AlgoliaAnalyticsObject;t&&((window[t].queue||[]).forEach(function(t){var r=t[0],n=t[1];r&&"function"==typeof e[r]&&e[r](n)}),window[t]=function(t,r){e[t](r)})}.bind(this),this.sendEvent=function(e,t){var r=this;t.timestamp=Date.now(),t.userID=this._userID;var n="http://localhost:8080/1/"+e+"?X-Algolia-Application-Id="+this._applicationID+"&X-Algolia-API-Key="+this._apiKey;if(navigator&&"function"==typeof navigator.sendBeacon&&"search"!==e)navigator.sendBeacon(n,JSON.stringify(t));else{var i=new XMLHttpRequest;i.open("POST",n),"search"===e&&(i.onreadystatechange=function(){if(4===i.readyState&&i.responseText){var e=i&&i.responseText?JSON.parse(i.responseText):{};r._lastQueryID=e.queryID}}),i.send(JSON.stringify(t))}}.bind(this),this.init=function(e){if(!e)throw new Error("Init function should be called with an object argument containing your apiKey and applicationID");if(!e.apiKey||"string"!=typeof e.apiKey)throw new Error("apiKey is missing, please provide it so we can authenticate the application");if(!e.applicationID||"string"!=typeof e.applicationID)throw new Error("applicationID is missing, please provide it, so we can properly attribute data to your application");this._apiKey=e.apiKey,this._applicationID=e.applicationID,this._hasCredentials=!0}.bind(this),this.initSearch=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("initSearch function requires an argument with getQueryID and hitsContainer arguments");if(!e.getQueryID||"function"!=typeof e.getQueryID)throw new Error("getQueryID must be a function that returns the queryID of the last search operation");this.getQueryID=e.getQueryID}.bind(this),this.click=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No params were sent to click function, please provide an objectID and position to be reported");if(!e.objectID)throw new Error("required objectID parameter was not sent, click event can not be properly attributed");if(!e.position)throw new Error("required position parameter was not sent, click event position can not be properly sent without");var t=e.queryID;if("function"!=typeof this.getQueryID||t||(t=this.getQueryID()||this._lastQueryID),!t)throw new Error("No queryID was retrieved, please check the implementation and provide either a getQueryID function\n    or call the search method that will return the queryID parameter");this.storageManager.storeClick(e.objectID,t);var r=Object.assign({},e,{queryID:t});this.sendEvent("click",r)}.bind(this),this.conversion=function(e){if(!this._hasCredentials)throw new Error("Before calling any methods on the analytics, you first need to call the 'init' function with applicationID and apiKey parameters");if(!e)throw new Error("No parameters were sent to conversion event, please provide an objectID");if(!e.objectID)throw new Error("No objectID was sent to conversion event, please provide an objectID");var t=e.queryID?e.queryID:this.storageManager.getConversionObjectID(e.objectID),r=Object.assign(e,{queryID:t});if(!t)throw new Error("No queryID was retrieved, please check the implementation and provide either a getQueryID function\n    or call the conversion method that will return the queryID parameter");this.sendEvent("conversion",r)}.bind(this),this._userID=s(),this.processQueue()}});
