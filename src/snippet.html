<script>
  (function () {
    var insights = (window.insights = window.insights || []);
    if (insights.initalized) {
      return;
    }
    if (insights.invoked) {
      if (window.console && console.error) {
        console.error('Algolia insights snippet included twice.');
      }
      return;
    }

    insights.invoked = true;
    insights.methods = [
      'init',
      'on',

      'setUserToken',
      'addAlgoliaAgent',

      'sendEvents',

      'clickedObjectIDsAfterSearch',
      'clickedObjectIDs',
      'clickedFilters',

      'convertedObjectIDsAfterSearch',
      'convertedObjectIDs',
      'convertedFilters',

      'viewedObjectIDs',
      'viewedFilters',
    ];

    // Define a factory to create stubs. These are placeholders
    // for methods in insights.js so that you never have to wait
    // for it to load to actually record data. The `method` is
    // stored as the first argument, so we can replay the data.
    insights.factory = function (method) {
      return function () {
        var args = Array.prototype.slice.call(arguments);
        args.unshift(method);
        insights.push(args);
        return insights;
      };
    };
    // For each of our methods, generate a queueing stub.
    for (var i = 0; i < insights.methods.length; i++) {
      var key = insights.methods[i];
      insights[key] = insights.factory(key);
    }

    insights.load = function (version) {
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      var cdnPath = 'https://cdn.jsdelivr.net/npm/search-insights';
      if (version) {
        cdnPath += '@' + version;
      }
      script.src = cdnPath;

      // Insert our script next to the first script element.
      var first = document.getElementsByTagName('script')[0];
      first.parentNode.insertBefore(script, first);
    };
    insights.load();

    insights.init('YourApplicationID', 'YourSearchOnlyAPIKey', {
      // region: "us",
      // anonmoyousId: { enabled: true, lease: 60 },
      // userToken: { cookie: true, lease: 1440 }
    });
  })();
</script>
